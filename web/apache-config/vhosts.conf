# ==============================================================================
# HOSTING CENTRUM - Apache VirtualHosts
#
# WEBSERVER TEAM: Add additional VirtualHosts as needed.
#
# Architecture:
#   1. Main VirtualHost - reverse proxy to Spring Boot API
#   2. Customer VirtualHosts - serve static content from /srv/customers/
#
# For testing, add to /etc/hosts:
#   127.0.0.1   localhost
#   127.0.0.1   www.mojefirma.cz mojefirma.cz
#   127.0.0.1   www.druhafirma.cz druhafirma.cz
#   127.0.0.1   www.tretifirma.cz tretifirma.cz
# ==============================================================================

# ==============================================================================
# MAIN VIRTUALHOST - Platform (API + Frontend)
#
# All requests go to Spring Boot backend.
# FRONTEND TEAM: If using React/Next.js, modify proxy rules.
# ==============================================================================
<VirtualHost *:80>
    ServerName localhost
    ServerAlias frontend.local

    DocumentRoot /srv/frontend

    <Directory /srv/frontend>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted

        # Povolit fallback pro React Router
        RewriteEngine On
        RewriteBase /
        RewriteRule ^index\.html$ - [L]
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule . /index.html [L]
    </Directory>

    ErrorLog /proc/self/fd/2
    CustomLog /proc/self/fd/1 combined
</VirtualHost>


# ==============================================================================
# CUSTOMER VIRTUALHOSTS
#
# Each customer has their domain and folder in /srv/customers/{user_id}/www/
#
# WEBSERVER TEAM: These VirtualHosts are for demonstration.
# In production, they would be generated dynamically or via .htaccess.
# ==============================================================================

# --- Test customer 1: mojefirma.cz ---
<VirtualHost *:80>
    ServerName www.mojefirma.cz
    ServerAlias mojefirma.cz

    # Customer folder (mapped via Docker volume)
    DocumentRoot /srv/customers/user_2/www

    <Directory /srv/customers/user_2/www>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    # Logs
    ErrorLog /proc/self/fd/2
    CustomLog /proc/self/fd/1 combined
</VirtualHost>

# --- Test customer 2: druhafirma.cz ---
<VirtualHost *:80>
    ServerName www.druhafirma.cz
    ServerAlias druhafirma.cz

    DocumentRoot /srv/customers/user_3/www

    <Directory /srv/customers/user_3/www>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    ErrorLog /proc/self/fd/2
    CustomLog /proc/self/fd/1 combined
</VirtualHost>

# --- Test customer 3: tretifirma.cz ---
<VirtualHost *:80>
    ServerName www.tretifirma.cz
    ServerAlias tretifirma.cz

    DocumentRoot /srv/customers/user_4/www

    <Directory /srv/customers/user_4/www>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    ErrorLog /proc/self/fd/2
    CustomLog /proc/self/fd/1 combined
</VirtualHost>
